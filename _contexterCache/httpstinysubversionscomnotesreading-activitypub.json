{"initialLink":"https://tinysubversions.com/notes/reading-activitypub/","sanitizedLink":"https://tinysubversions.com/notes/reading-activitypub/","finalLink":"https://tinysubversions.com/notes/reading-activitypub/","htmlEmbed":"<script>window.contexterSetup=window.contexterSetup||function(){window.contexterSetupComplete=!0;class ContexterLink extends HTMLAnchorElement{constructor(){super()}connectedCallback(){this.setAttribute(\"target\",\"_blank\")}}customElements.define(\"contexter-link\",ContexterLink,{extends:\"a\"}),customElements.define(\"contexter-inner\",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className=\"contexter-box__inner\"}}),customElements.define(\"contexter-thumbnail\",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className=\"contexter-box__thumbnail\"}}),customElements.define(\"contexter-byline\",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className=\"contexter-box__byline\"}}),customElements.define(\"contexter-keywordset\",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className=\"contexter-box__keywordset\"}}),customElements.define(\"contexter-linkset\",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className=\"contexter-box__linkset\"}}),customElements.define(\"contexter-meta\",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className=\"contexter-box__meta\"}}),customElements.define(\"contexter-summary\",class extends HTMLElement{constructor(){super()}attributeChangedCallback(name,oldValue,newValue){}connectedCallback(){this.className=\"p-summary entry-summary\"}}),customElements.define(\"contexter-box-head\",class extends HTMLElement{constructor(){super()}connectedCallback(){this.className=\"contexter-box__head\"}}),customElements.define(\"contexter-box-inner\",class extends HTMLElement{constructor(){super()}connectedCallback(){}});class ContexterBox extends HTMLElement{constructor(){super(),this.first=!0,this.shadow=this.attachShadow({mode:\"open\"})}connectedCallback(){if(this.first){this.first=!1;var style=document.createElement(\"style\"),lightDomStyle=(style.innerHTML=`:host {--background: #f5f6f7;--border: darkblue;--blue: #0000ee;--font-color: black;--inner-border: black;font-family: Franklin,Arial,Helvetica,sans-serif;font-size: 14px;background: var(--background);width: 600px;color: var(--font-color);min-height: 90px;display: block;padding: 8px;border: 1px solid var(--border);cursor: pointer;box-sizing: border-box;margin: 6px;contain: content;margin: 6px auto;}// can only select top-level nodes with slotted::slotted(*) {max-width: 100%;display:block;}::slotted([slot=thumbnail]) {max-width: 100%;display:block;}::slotted([slot=header]) {width: 100%;font-size: 1.25rem;font-weight: bold;display:block;margin-bottom: 6px;}::slotted([slot=author]) {max-width: 50%;font-size: 12px;display:inline-block;float: left;}::slotted([slot=time]) {max-width: 50%;font-size: 12px;display:inline-block;float: right;}::slotted([slot=summary]) {width: 100%;margin-top: 6px;padding: 10px 2px;border-top: 1px solid var(--inner-border);font-size: 15px;display:inline-block;margin-bottom: 6px;}contexter-meta {height: auto;margin-bottom: 4px;width: 100%;display: grid;position: relative;min-height: 16px;grid-template-columns: repeat(2, 1fr);}::slotted([slot=keywords]) {width: 80%;padding: 2px 4px;border-top: 1px solid var(--inner-border);font-size: 11px;display: block;float: right;font-style: italic;text-align: right;grid-column: 2/2;grid-row: 1;align-self: end;justify-self: end;}::slotted([slot=keywords]):empty {border-top: 0px solid var(--inner-border);}::slotted([slot=archive-link]) {font-size: 1em;display: inline;}::slotted([slot=archive-link])::after {content: \"|\";display: inline;color: var(--font-color);text-decoration: none;margin: 0 .5em;}::slotted([slot=read-link]) {font-size: 1em;display: inline;}contexter-linkset {width: 80%;padding: 2px 4px;font-size: 13px;float: left;font-weight: bold;grid-row: 1;grid-column: 1/2;align-self: end;justify-self: start;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {:host {width: 310px;}}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){:host {--background: #354150;--border: #1f2b37;--blue: #55b0ff;--font-color: #ffffff;--inner-border: #787a7c;background: var(--background);border: 1px solid var(--border)}}`,document.createElement(\"style\"));lightDomStyle.innerHTML=`contexter-box {contain: content;}contexter-box .read-link {font-weight: bold;}contexter-box a {color: #0000ee;}contexter-box img {width: 100%;border: 0;padding: 0;margin: 0;}/* Extra small devices (phones, 600px and down) */@media only screen and (max-width: 600px) {...}/* Small devices (portrait tablets and large phones, 600px and up) */@media only screen and (min-width: 600px) {...}/* Medium devices (landscape tablets, 768px and up) */@media only screen and (min-width: 768px) {...}/* Large devices (laptops/desktops, 992px and up) */@media only screen and (min-width: 992px) {...}/* Extra large devices (large laptops and desktops, 1200px and up) */@media only screen and (min-width: 1200px) {...}@media (prefers-color-scheme: dark){contexter-box a {color: #55b0ff;}}`,this.appendChild(lightDomStyle),this.shadow.appendChild(style);const innerContainer=document.createElement(\"contexter-box-inner\"),innerSlotThumbnail=(this.shadow.appendChild(innerContainer),document.createElement(\"slot\")),innerSlotHeader=(innerSlotThumbnail.name=\"thumbnail\",innerContainer.appendChild(innerSlotThumbnail),document.createElement(\"slot\")),innerSlotAuthor=(innerSlotHeader.name=\"header\",innerContainer.appendChild(innerSlotHeader),document.createElement(\"slot\")),innerSlotTime=(innerSlotAuthor.name=\"author\",innerContainer.appendChild(innerSlotAuthor),document.createElement(\"slot\")),innerSlotSummary=(innerSlotTime.name=\"time\",innerContainer.appendChild(innerSlotTime),document.createElement(\"slot\")),metaContainer=(innerSlotSummary.name=\"summary\",innerContainer.appendChild(innerSlotSummary),document.createElement(\"contexter-meta\")),innerSlotInfo=(innerContainer.appendChild(metaContainer),document.createElement(\"slot\")),linkContainer=(innerSlotInfo.name=\"keywords\",metaContainer.appendChild(innerSlotInfo),document.createElement(\"contexter-linkset\")),innerSlotArchiveLink=(metaContainer.appendChild(linkContainer),document.createElement(\"slot\")),innerSlotReadLink=(innerSlotArchiveLink.name=\"archive-link\",linkContainer.appendChild(innerSlotArchiveLink),document.createElement(\"slot\"));innerSlotReadLink.name=\"read-link\",linkContainer.appendChild(innerSlotReadLink),this.className=\"contexter-box\",this.onclick=e=>{if(!e.target.className.includes(\"read-link\")&&!e.target.className.includes(\"title-link\")){const mainLinks=this.querySelectorAll(\"a.main-link\");mainLinks[0].click()}}}}}customElements.define(\"contexter-box\",ContexterBox)},window.contexterSetupComplete||window.contexterSetup();</script><contexter-box class=\"link-card h-entry hentry\" itemscope=\"\" itemtype=\"https://schema.org/CreativeWork\"><contexter-thumbnail class=\"thumbnail\" slot=\"thumbnail\"></contexter-thumbnail><contexter-box-head slot=\"header\" class=\"p-name entry-title\" itemprop=\"headline\"><contexter-box-head slot=\"header\" class=\"p-name entry-title\" itemprop=\"headline\"><a is=\"contexter-link\" href=\"https://tinysubversions.com/notes/reading-activitypub/\" itemprop=\"url\">reading-activitypub</a></contexter-box-head></contexter-box-head><time class=\"dt-published published\" slot=\"time\" itemprop=\"datePublished\" datetime=\"2022-03-09T18:43:55.345Z\">2/9/2022</time><contexter-summary class=\"p-summary entry-summary\" itemprop=\"abstract\" slot=\"summary\"><p>‚Üê Tiny Subversions</p></contexter-summary><contexter-keywordset itemprop=\"keywords\" slot=\"keywords\"></contexter-keywordset><a is=\"contexter-link\" href=\"https://tinysubversions.com/notes/reading-activitypub/\" class=\"read-link main-link\" itemprop=\"sameAs\" slot=\"read-link\">Read</a></contexter-box>","linkId":"eefb1968db1da1471f823df3d504d25e98950437","data":{"originalLink":"https://tinysubversions.com/notes/reading-activitypub/","sanitizedLink":"https://tinysubversions.com/notes/reading-activitypub/","canonical":"https://tinysubversions.com/notes/reading-activitypub/","htmlText":"<!DOCTYPE html> <html lang=\"en\"> <head> <meta charset=\"utf-8\"> <title>reading-activitypub</title> <meta charset=\"UTF-8\"> <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"> <link rel='stylesheet' href='../css/style.css' type='text/css' media='all' /> </head> <body><p><a href=\"..\">&larr; Tiny Subversions</a></p>\n<h1 id=\"a-highly-opinionated-guide-to-learning-about-activitypub\">A highly opinionated guide to learning about ActivityPub</h1>\n<p><em>by Darius Kazemi, Jun 1, 2019</em></p>\n<p>This document is for programmers who take one look at <a href=\"https://activitypub.rocks\">activitypub.rocks</a>, click on through to the documentation, and can&#39;t make heads or tails of it.</p>\n<p>In other words this document is for me, one year ago.</p>\n<p><strong>IMPORTANT NOTE: This document does not explain ActivityPub. It explains <em>how to learn about ActivityPub</em>.</strong></p>\n<p>If you want THE ULTIMATE TL;DR, just <a href=\"#the-ultimate-tl-dr\">skip to that section</a>.</p>\n<h1 id=\"table-of-contents\">Table of contents</h1>\n<ul>\n<li><a href=\"#introduction\">Introduction</a><ul>\n<li><a href=\"#start-with-activity-vocabulary\">Start with Activity Vocabulary</a></li>\n</ul>\n</li>\n<li><a href=\"#reading-activity-vocabulary\">Reading Activity Vocabulary</a><ul>\n<li><a href=\"#introduction-1\">Introduction</a></li>\n<li><a href=\"#core-types\">Core Types</a></li>\n<li><a href=\"#extended-types\">Extended Types</a><ul>\n<li><a href=\"#activity-types\">Activity Types</a></li>\n<li><a href=\"#actor-types\">Actor Types</a></li>\n<li><a href=\"#object-types\">Object Types</a></li>\n<li><a href=\"#putting-it-all-together\">Putting it all together</a></li>\n</ul>\n</li>\n<li><a href=\"#properties\">Properties</a></li>\n<li><a href=\"#implemenation-notes\">Implemenation Notes</a></li>\n</ul>\n</li>\n<li><a href=\"#reading-activitypub\">Reading ActivityPub</a><ul>\n<li><a href=\"#a-note-on-json-ld\">A note on JSON-LD</a><ul>\n<li><a href=\"#following-links-in-json\">Following links in JSON</a></li>\n</ul>\n</li>\n<li><a href=\"#overview\">Overview</a></li>\n<li><a href=\"#conformance\">Conformance</a></li>\n<li><a href=\"#objects\">Objects</a></li>\n<li><a href=\"#actors\">Actors</a></li>\n<li><a href=\"#collections\">Collections</a></li>\n<li><a href=\"#client-to-server-interactions\">Client to Server Interactions</a></li>\n<li><a href=\"#server-to-server-interactions\">Server to Server Interactions</a></li>\n</ul>\n</li>\n<li><a href=\"#reading-activitystreams-2-0\">Reading ActivityStreams 2.0</a></li>\n<li><a href=\"#the-ultimate-tl-dr\">THE ULTIMATE TL;DR</a></li>\n<li><a href=\"#go-forth-and-make-stuff\">Go forth and make stuff</a></li>\n</ul>\n<h1 id=\"introduction\">Introduction</h1>\n<p>The one big misunderstanding that a programmer can have when attempting to learn about ActivityPub is to assume that all the information you need is in the ActivityPub spec! Really, to learn about ActivityPub in such a way that it will be useful in a concrete sense, you need to be familiar with three specs:</p>\n<ul>\n<li><a href=\"https://www.w3.org/TR/activitypub/\">ActivityPub</a></li>\n<li><a href=\"https://www.w3.org/TR/activitystreams-core/\">ActivityStreams 2.0</a></li>\n<li><a href=\"https://www.w3.org/TR/activitystreams-vocabulary/\">Activity Vocabulary</a></li>\n</ul>\n<p>Those two extra documents are in fact mentioned in the ActivityPub spec itself, so I&#39;m not claiming that they are somehow hidden. But I&#39;m a lazy, impatient reader. When I&#39;m given a spec like ActivityPub that is ~10,000 words of spec language... well. I&#39;m going to try and take all the shortcuts I can.</p>\n<p>I thought I was the only programmer with this problem, but as I spoke to more and more people at conferences, I realized there are many others who, for example, look at ActivityPub and yet have no idea there exists an Activity Vocabulary spec.</p>\n<h2 id=\"start-with-activity-vocabulary\">Start with Activity Vocabulary</h2>\n<p>I am a concrete thinker. I don&#39;t like reading about a system for passing messages between computers if I can&#39;t have some sort of understanding of <em>what exactly</em> is being passed around.</p>\n<p>Unfortunately, the ActivityPub spec is mostly all about the &quot;publication&quot; part and not the &quot;what data are we sending around&quot; part.</p>\n<p>For this reason, <strong>I recommend that you start your journey into ActivityPub by first reading the <a href=\"https://www.w3.org/TR/activitystreams-vocabulary/\">Activity Vocabulary spec</a></strong>.</p>\n<h1 id=\"reading-activity-vocabulary\">Reading Activity Vocabulary</h1>\n<p>This spec is in five non-appendix sections:</p>\n<ol>\n<li>Introduction</li>\n<li>Core Types</li>\n<li>Extended Types</li>\n<li>Properties</li>\n<li>Implementation Notes</li>\n</ol>\n<h2 id=\"introduction\">Introduction</h2>\n<p>The intro is brief, and is your usual spec boilerplate about  the definitions of MUST and SHOULD.</p>\n<h2 id=\"core-types\">Core Types</h2>\n<p>&quot;Core Types&quot; is where you might think you should start. It&#39;s the core, right? Well, you&#39;re wrong. The first thing you&#39;re hit with is a definition of <strong>Object</strong>:</p>\n<blockquote>\n<p>Describes an object of any kind. The Object type serves as the base type for most of the other kinds of objects defined in the Activity Vocabulary, including other Core types such as Activity, IntransitiveActivity, Collection and OrderedCollection. </p>\n</blockquote>\n<p>The example given is:</p>\n<pre><code>{\n  &quot;@context&quot;: &quot;https://www.w3.org/ns/activitystreams&quot;,\n  &quot;type&quot;: &quot;Object&quot;,\n  &quot;id&quot;: &quot;http://www.test.example/object/1&quot;,\n  &quot;name&quot;: &quot;A Simple, non-specific object&quot;\n}\n</code></pre><p>Wow. That&#39;s real useful. Now I know how to define a non-specific thing with no properties.</p>\n<p>(Aside: this &quot;begin from first principles&quot; thing is a problem with almost all spec writing. It is largely <em>how specs are written</em> and it fucking blows. The authors of these documents are just following tradition and I do not wish to paint these specs as particularly bad.)</p>\n<p>Just skip the Core Types for now and move onto section 3, Extended Types.</p>\n<h2 id=\"extended-types\">Extended Types</h2>\n<p>Ah, Extended Types. Or as I like to call them: the actually-useful types. Something like 50% of the stuff you actually care about is in this section.</p>\n<p>We are given three major kinds of &quot;types&quot;. (Um, by the way, this isn&#39;t quite a &quot;type&quot; as you may know it. It&#39;s really more like a JSON data format.)</p>\n<ul>\n<li>Activity Types</li>\n<li>Actor Types</li>\n<li>Object Types</li>\n</ul>\n<h3 id=\"activity-types\">Activity Types</h3>\n<p>We are once again immediately hit over the head with this doozy of a sentence:</p>\n<blockquote>\n<p>All Activity Types inherit the properties of the base <strong>Activity</strong> type.</p>\n</blockquote>\n<p>While this does make sense in a highly specific way that is unique to specification writing, please just skip this sentence and all sentences like it (there is at least one other saying the same thing about Object Types).</p>\n<p>Best to avoid the near-tautological definitions required for writing things like parsers and instead skip to the concrete stuff. Scroll down and you&#39;ll see that Activity Types include things like:</p>\n<ul>\n<li>Accept</li>\n<li>Block</li>\n<li>Follow</li>\n<li>Like</li>\n</ul>\n<p>Hey!! This is good! This is like... stuff that users do on social networks. Now we&#39;re getting somewhere.</p>\n<p>Browse over all the activities. Look at the &quot;Notes&quot; section and glance at the example JSON object. There are some interesting activity types in there! For example, there&#39;s <strong>Question</strong>, which is the activity type that Mastodon uses in its implementation of polls. And there&#39;s <strong>Travel</strong>, which is meant to indicate movement from geographic (or even conceptual) point A to point B! You might make extensive use of this if your social network supported a Facebook style &quot;I&#39;ve checked in to New York City right now&quot; post. There&#39;s even a <strong>View</strong> activity, which can be used for read receipts.</p>\n<p>Anyway, read &#39;em.</p>\n<h3 id=\"actor-types\">Actor Types</h3>\n<p>An <strong>Actor</strong> is what you might think of as a user agent. It can be a person, a bot, a company, a group of people, and more. But the important thing is: an <strong>Actor</strong> is the <em>thing that is doing</em> an <strong>Activity</strong>.</p>\n<p>So a normal post to Mastodon is a <strong>Person</strong> actor doing a <strong>Create</strong> activity (what is being created is defined in the next section, Object types). Or if a company sent out discount codes to its followers, that would be an <strong>Organization</strong> doing an <strong>Offer</strong> activity.</p>\n<p>There aren&#39;t many <strong>Actor</strong> types listed so just read them all.</p>\n<h3 id=\"object-types\">Object Types</h3>\n<p>Yeah. I know. &quot;Object&quot; is probably the most overloaded English word in programming and we&#39;re already on our second thing called an object in this one spec. I&#39;m sorry. Deep breaths, we&#39;ll get through this.</p>\n<p>Anyhow. These are the meat and potatoes of what actually gets sent around these networks. Object types include:</p>\n<ul>\n<li>Note</li>\n<li>Article</li>\n<li>Image</li>\n<li>Video</li>\n</ul>\n<p>...and several more. So when you make a regular text post to Mastodon, that is a case where a <strong>Person</strong> will <strong>Create</strong> a <strong>Note</strong>.</p>\n<h3 id=\"putting-it-all-together\">Putting it all together</h3>\n<p>Here&#39;s some code from <a href=\"https://github.com/dariusk/express-activitypub/\">a small ActivityPub reference implementation I wrote</a></p>\n<pre><code>  let noteMessage = {\n    &#39;id&#39;: `https://${domain}/m/${guidNote}`,\n    &#39;type&#39;: &#39;Note&#39;,\n    &#39;published&#39;: d.toISOString(),\n    &#39;attributedTo&#39;: `https://${domain}/u/${name}`,\n    &#39;content&#39;: text,\n    &#39;to&#39;: [&#39;https://www.w3.org/ns/activitystreams#Public&#39;],\n  };\n\n  let createMessage = {\n    &#39;@context&#39;: &#39;https://www.w3.org/ns/activitystreams&#39;,\n\n    &#39;id&#39;: `https://${domain}/m/${guidCreate}`,\n    &#39;type&#39;: &#39;Create&#39;,\n    &#39;actor&#39;: `https://${domain}/u/${name}`,\n    &#39;to&#39;: [&#39;https://www.w3.org/ns/activitystreams#Public&#39;],\n    &#39;cc&#39;: [follower],\n\n    &#39;object&#39;: noteMessage\n  };\n</code></pre><p>I construct the <strong>Note</strong> object and the <strong>Create</strong> activity. The <strong>Note</strong> object gets embedded inside the <strong>Create</strong> activity, which indicates that we are <strong>Creat</strong>-ing a <strong>Note</strong>. What about the <strong>Person</strong>? That&#39;s implied in the &#39;actor&#39; field of the <strong>Create</strong>, and that URL is the equivalent of passing the <strong>Person</strong> by reference. Any program parsing this out could query that URL and get the JSON of the <strong>Person</strong> from there.</p>\n<h2 id=\"properties\">Properties</h2>\n<p>If you&#39;re wondering what those &quot;id&quot;, &quot;cc&quot;, and so on fields mean, you&#39;re in luck. Those are described in this section, which contains the <em>other</em> 50% of the stuff you care about.</p>\n<p>Read this section, if only to familiarize yourself with what&#39;s here. That way you&#39;ll know to come back here when you see something like &quot;prev&quot; in a JSON object and wonder how that&#39;s supposed to be constructed.</p>\n<h2 id=\"implementation-notes\">Implementation Notes</h2>\n<p>This is where the concrete examples of things like &quot;how to represent a friend request&quot; live. Definitely worth reading this section as well, though on a first run through you really only need to read:</p>\n<ul>\n<li>5.1: Audience targeting (not about advertising, this is about what the &quot;to&quot; and &quot;cc&quot; fields mean. It&#39;s the difference between a direct message and a public message, for example.)</li>\n<li>5.2.1: Modeling a &quot;friend request&quot;</li>\n<li>5.5: How <strong>Undo</strong> does and does not work</li>\n<li>5.8: A nice conceptual grouping of what circumstances you might use different Activities in</li>\n</ul>\n<h1 id=\"reading-activitypub\">Reading ActivityPub</h1>\n<p>Next, read <a href=\"https://www.w3.org/TR/activitypub/\">the ActivityPub spec</a>. It&#39;s in seven major sections:</p>\n<ol>\n<li>Overview</li>\n<li>Conformance</li>\n<li>Objects</li>\n<li>Actors</li>\n<li>Collections</li>\n<li>Client to Server Interactions</li>\n<li>Server to Server Interactions</li>\n</ol>\n<p>But first, a word about JSON-LD.</p>\n<h2 id=\"a-note-on-json-ld\">A note on JSON-LD</h2>\n<p>Starting with the ActivityPub spec, you&#39;re going to see <a href=\"https://json-ld.org/\">JSON-LD</a> mentioned a bunch. You don&#39;t have to care about this at all. For our purposes it&#39;s JSON with some specific property names in it, and where you follow links to complete the content of an object. Is this technically 100% correct? No. But if you were the kind of person who cared about the difference between JSON-LD and JSON, you&#39;d probably be writing your own spec right now instead of reading this article.</p>\n<h3 id=\"following-links-in-json\">Following links in JSON</h3>\n<p>One important thing to note about the kind of JSON stuff you&#39;ll be seeing is that you&#39;ll often see a URI embedded in a JSON object. Take the following example of an object with no URI anywhere in it:</p>\n<pre><code>{\n  &quot;id&quot;: 1234,\n  &quot;object&quot;: {\n    &quot;type&quot;: &quot;Note&quot;,\n    &quot;content&quot;: &quot;Hello world.&quot;\n  }\n}\n</code></pre><p>Other times you&#39;ll see something like:</p>\n<pre><code>{\n  &quot;id&quot;: 1234,\n  &quot;object&quot;: &quot;https://example.com/5678&quot;\n}\n</code></pre><p>But then if you do a GET request with the appropriate headers to &quot;<a href=\"https://example.com/5678\">https://example.com/5678</a>&quot;, you&#39;ll get</p>\n<pre><code>{\n  &quot;type&quot;: &quot;Note&quot;,\n  &quot;content&quot;: &quot;Hello world.&quot;\n}\n</code></pre><p>These two JSON things comprise the exact same information as that first JSON thing. It&#39;s just split across two HTTP requests. When you encounter a URI in one of these JSON objects, the idea is to follow the URI in order to resolve it into plain JSON and consider that the sub-object.</p>\n<h2 id=\"overview\">Overview</h2>\n<p>Read this whole thing. You probably tried to read this once, before reading the Vocabulary spec, and if you&#39;re anything like me you were extremely confused. I promise it will be less confusing this time.</p>\n<p>Basically it explains that you&#39;re taking these JSON things described in the Vocabulary spec and POSTing them to specific API endpoints, which process them.</p>\n<h2 id=\"conformance\">Conformance</h2>\n<p>A short section that you might as well read. This is where it&#39;s made clear that this document actually describes <em>two separate protocols</em>. There is a Client to Server (C2S) and Server to Server (S2S).</p>\n<p>In order to make your service &quot;federated&quot; via ActivityPub, <em>the only protocol you really care about is the server to server protocol</em>. S2S is how a Mastodon server can talk to a Pleroma server can talk to a Pixelfed server etc etc. Federation as we know it.</p>\n<p>The C2S protocol is about <em>user choice</em>. It&#39;s a good thing, but it has nothing to do with federation. It&#39;s a standard way for user client software, like a phone app, to talk to a server. If we lived in a world where Mastodon and Pleroma and Pixelfed all used the C2S protocol, then in theory I could easily write a phone app that connects to all three of those services, and users could mix and match clients with servers to their heart&#39;s delight. A new service could pop up that I didn&#39;t even know about, but if it used C2S my phone app would be minimally compatible with it. (We do not live in this world, most federated services do not implement C2S, but this is the vision, to my understanding.)</p>\n<h2 id=\"objects\">Objects</h2>\n<p>This will be a much easier read now that you&#39;ve read over the Vocabulary document.</p>\n<p>Specifically, sections 3, 3.1, and 3.2 are really important and discuss why, for example, if you send a message to a remote server, it should have some way of querying your server to confirm the message. I originally thought that I could get away with just sending messages into the void and not storing them in a local database, but I was wrong, because remote servers need to confirm that it&#39;s not just some random person claiming to send content from my own origin.</p>\n<h2 id=\"actors\">Actors</h2>\n<p>So an ActivityPub actor is an Activity Vocabulary actor, with the mandatory addition of an inbox and and outbox, which are typically URIs that you either GET or POST to depending on what you want to do with them. For example, you can GET from a user&#39;s outbox URI and receive a JSON list of posts. Try it on my outbox from Friend Camp right now in your web browser by <a href=\"https://friend.camp/users/darius/outbox\">browsing to this URL</a>. You should see something like this:</p>\n<pre><code>{\n  &quot;@context&quot;:&quot;https://www.w3.org/ns/activitystreams&quot;,\n  &quot;id&quot;:&quot;https://friend.camp/users/darius/outbox&quot;,\n  &quot;type&quot;:&quot;OrderedCollection&quot;,\n  &quot;totalItems&quot;:5688,\n  &quot;first&quot;:&quot;https://friend.camp/users/darius/outbox?page=true&quot;,\n  &quot;last&quot;:&quot;https://friend.camp/users/darius/outbox?min_id=0&amp;page=true&quot;\n}\n</code></pre><p>If you click through to <a href=\"https://friend.camp/users/darius/outbox?min_id=0&amp;page=true\">the &quot;last&quot; URI</a>, you&#39;ll get 20 of my oldest posts from Friend Camp, including <a href=\"https://friend.camp/@darius/100538943364185987\">this charmer</a>.</p>\n<p>Anyway, read this whole section too. It&#39;s short.</p>\n<h2 id=\"collections\">Collections</h2>\n<p>Skip this for now. You&#39;ll absolutely want to come back to this later but you can probably figure out what collections are in context of their usage (hint: that outbox JSON is a type of collection; it contains paging data for iterating through collections of stuff).</p>\n<p>But seriously just skip this for now, you don&#39;t need to muddy your brain with it.</p>\n<h2 id=\"client-to-server-interactions\">Client to Server Interactions</h2>\n<p>Look. If you want to support a universal client ecosystem, go ahead and read this section. But if you just want to write a federated service, skip it and come back to it later.</p>\n<h2 id=\"server-to-server-interactions\">Server to Server Interactions</h2>\n<p>Read this whole thing. This one section, combined with the Activity Vocabulary spec, forms the absolute basics of getting a federated service up and running. The Vocabulary spec tells you <em>what</em> to send, and this section tells you <em>how</em> to send it.</p>\n<p>Among other things, it discusses the difference between an <code>inbox</code> and a <code>sharedInbox</code>. It talks about how to <strong>Follow</strong> an <strong>Actor</strong>, and how someone might <strong>Accept</strong> or <strong>Reject</strong> a follow request. It talks about <strong>Announce</strong>, which in addition to literally being for announcements, is also your standard &quot;sharing&quot; activity, like an RT on Twitter or a boost on Mastodon.</p>\n<h1 id=\"reading-activitystreams-2-0\">Reading ActivityStreams 2.0</h1>\n<p>Eh. Don&#39;t read it now. Skim the table of contents. There will be bits of ActivityPub that don&#39;t make sense without the ActivityStreams 2.0 spec, but those will be more advanced questions you&#39;ll have later.</p>\n<h1 id=\"the-ultimate-tl-dr\">THE ULTIMATE TL;DR</h1>\n<ul>\n<li>Read the <a href=\"https://www.w3.org/TR/activitystreams-vocabulary/\">Activity Vocabulary spec</a>, sections 3, 4, 5.1, 5.2.1, 5.5, and 5.8</li>\n<li>Read the <a href=\"https://www.w3.org/TR/activitypub/\">ActivityPub spec</a>, sections 1, 2, 3, 4, and 7</li>\n<li>Familiarize yourself with the table of contents for the <a href=\"https://www.w3.org/TR/activitystreams-core/\">ActivityStreams 2.0 spec</a>.</li>\n</ul>\n<h1 id=\"go-forth-and-make-stuff\">Go forth and make stuff</h1>\n<p>Assuming you&#39;ve done all this reading, the knowledge you have right now should hopefully be enough to start hacking on sending simple messages via ActivityPub.</p>\n<p>I recommend reading these two articles by Eugen Rochko, the creator of Mastodon:</p>\n<ul>\n<li><a href=\"https://blog.joinmastodon.org/2018/06/how-to-implement-a-basic-activitypub-server/\">How to implement a basic ActivityPub server</a></li>\n<li><a href=\"https://blog.joinmastodon.org/2018/07/how-to-make-friends-and-verify-requests/\">How to make friends and verify requests</a></li>\n</ul>\n<p>If you&#39;re like me and you enjoy poking around at a simple implementation, I have written a bare bones JavaScript ActivityPub server using the popular Express application framework:</p>\n<ul>\n<li><a href=\"https://github.com/dariusk/express-activitypub\">Express ActivityPub Server</a></li>\n</ul>\n\n<script src=\"../js/highlight.pack.js\"></script><script>hljs.initHighlightingOnLoad();</script></body></html>\n","oembed":false,"readabilityObject":{"title":"reading-activitypub","content":"<div id=\"readability-page-1\" class=\"page\"><p><a href=\"..\">‚Üê Tiny Subversions</a></p>\n<h2 id=\"a-highly-opinionated-guide-to-learning-about-activitypub\">A highly opinionated guide to learning about ActivityPub</h2>\n<p><em>by Darius Kazemi, Jun 1, 2019</em></p>\n<p>This document is for programmers who take one look at <a href=\"https://activitypub.rocks/\">activitypub.rocks</a>, click on through to the documentation, and can't make heads or tails of it.</p>\n<p>In other words this document is for me, one year ago.</p>\n<p><strong>IMPORTANT NOTE: This document does not explain ActivityPub. It explains <em>how to learn about ActivityPub</em>.</strong></p>\n<p>If you want THE ULTIMATE TL;DR, just <a href=\"#the-ultimate-tl-dr\">skip to that section</a>.</p>\n<h2 id=\"table-of-contents\">Table of contents</h2>\n<ul>\n<li><a href=\"#introduction\">Introduction</a><ul>\n<li><a href=\"#start-with-activity-vocabulary\">Start with Activity Vocabulary</a></li>\n</ul>\n</li>\n<li><a href=\"#reading-activity-vocabulary\">Reading Activity Vocabulary</a><ul>\n<li><a href=\"#introduction-1\">Introduction</a></li>\n<li><a href=\"#core-types\">Core Types</a></li>\n<li><a href=\"#extended-types\">Extended Types</a><ul>\n<li><a href=\"#activity-types\">Activity Types</a></li>\n<li><a href=\"#actor-types\">Actor Types</a></li>\n<li><a href=\"#object-types\">Object Types</a></li>\n<li><a href=\"#putting-it-all-together\">Putting it all together</a></li>\n</ul>\n</li>\n<li><a href=\"#properties\">Properties</a></li>\n<li><a href=\"#implemenation-notes\">Implemenation Notes</a></li>\n</ul>\n</li>\n<li><a href=\"#reading-activitypub\">Reading ActivityPub</a><ul>\n<li><a href=\"#a-note-on-json-ld\">A note on JSON-LD</a><ul>\n<li><a href=\"#following-links-in-json\">Following links in JSON</a></li>\n</ul>\n</li>\n<li><a href=\"#overview\">Overview</a></li>\n<li><a href=\"#conformance\">Conformance</a></li>\n<li><a href=\"#objects\">Objects</a></li>\n<li><a href=\"#actors\">Actors</a></li>\n<li><a href=\"#collections\">Collections</a></li>\n<li><a href=\"#client-to-server-interactions\">Client to Server Interactions</a></li>\n<li><a href=\"#server-to-server-interactions\">Server to Server Interactions</a></li>\n</ul>\n</li>\n<li><a href=\"#reading-activitystreams-2-0\">Reading ActivityStreams 2.0</a></li>\n<li><a href=\"#the-ultimate-tl-dr\">THE ULTIMATE TL;DR</a></li>\n<li><a href=\"#go-forth-and-make-stuff\">Go forth and make stuff</a></li>\n</ul>\n<h2 id=\"introduction\">Introduction</h2>\n<p>The one big misunderstanding that a programmer can have when attempting to learn about ActivityPub is to assume that all the information you need is in the ActivityPub spec! Really, to learn about ActivityPub in such a way that it will be useful in a concrete sense, you need to be familiar with three specs:</p>\n<ul>\n<li><a href=\"https://www.w3.org/TR/activitypub/\">ActivityPub</a></li>\n<li><a href=\"https://www.w3.org/TR/activitystreams-core/\">ActivityStreams 2.0</a></li>\n<li><a href=\"https://www.w3.org/TR/activitystreams-vocabulary/\">Activity Vocabulary</a></li>\n</ul>\n<p>Those two extra documents are in fact mentioned in the ActivityPub spec itself, so I'm not claiming that they are somehow hidden. But I'm a lazy, impatient reader. When I'm given a spec like ActivityPub that is ~10,000 words of spec language... well. I'm going to try and take all the shortcuts I can.</p>\n<p>I thought I was the only programmer with this problem, but as I spoke to more and more people at conferences, I realized there are many others who, for example, look at ActivityPub and yet have no idea there exists an Activity Vocabulary spec.</p>\n<h2 id=\"start-with-activity-vocabulary\">Start with Activity Vocabulary</h2>\n<p>I am a concrete thinker. I don't like reading about a system for passing messages between computers if I can't have some sort of understanding of <em>what exactly</em> is being passed around.</p>\n<p>Unfortunately, the ActivityPub spec is mostly all about the \"publication\" part and not the \"what data are we sending around\" part.</p>\n<p>For this reason, <strong>I recommend that you start your journey into ActivityPub by first reading the <a href=\"https://www.w3.org/TR/activitystreams-vocabulary/\">Activity Vocabulary spec</a></strong>.</p>\n<h2 id=\"reading-activity-vocabulary\">Reading Activity Vocabulary</h2>\n<p>This spec is in five non-appendix sections:</p>\n<ol>\n<li>Introduction</li>\n<li>Core Types</li>\n<li>Extended Types</li>\n<li>Properties</li>\n<li>Implementation Notes</li>\n</ol>\n<h2 id=\"introduction\">Introduction</h2>\n<p>The intro is brief, and is your usual spec boilerplate about  the definitions of MUST and SHOULD.</p>\n<h2 id=\"core-types\">Core Types</h2>\n<p>\"Core Types\" is where you might think you should start. It's the core, right? Well, you're wrong. The first thing you're hit with is a definition of <strong>Object</strong>:</p>\n<blockquote>\n<p>Describes an object of any kind. The Object type serves as the base type for most of the other kinds of objects defined in the Activity Vocabulary, including other Core types such as Activity, IntransitiveActivity, Collection and OrderedCollection. </p>\n</blockquote>\n<p>The example given is:</p>\n<pre><code>{\n  \"@context\": \"https://www.w3.org/ns/activitystreams\",\n  \"type\": \"Object\",\n  \"id\": \"http://www.test.example/object/1\",\n  \"name\": \"A Simple, non-specific object\"\n}\n</code></pre><p>Wow. That's real useful. Now I know how to define a non-specific thing with no properties.</p>\n<p>(Aside: this \"begin from first principles\" thing is a problem with almost all spec writing. It is largely <em>how specs are written</em> and it fucking blows. The authors of these documents are just following tradition and I do not wish to paint these specs as particularly bad.)</p>\n<p>Just skip the Core Types for now and move onto section 3, Extended Types.</p>\n<h2 id=\"extended-types\">Extended Types</h2>\n<p>Ah, Extended Types. Or as I like to call them: the actually-useful types. Something like 50% of the stuff you actually care about is in this section.</p>\n<p>We are given three major kinds of \"types\". (Um, by the way, this isn't quite a \"type\" as you may know it. It's really more like a JSON data format.)</p>\n<ul>\n<li>Activity Types</li>\n<li>Actor Types</li>\n<li>Object Types</li>\n</ul>\n<h3 id=\"activity-types\">Activity Types</h3>\n<p>We are once again immediately hit over the head with this doozy of a sentence:</p>\n<blockquote>\n<p>All Activity Types inherit the properties of the base <strong>Activity</strong> type.</p>\n</blockquote>\n<p>While this does make sense in a highly specific way that is unique to specification writing, please just skip this sentence and all sentences like it (there is at least one other saying the same thing about Object Types).</p>\n<p>Best to avoid the near-tautological definitions required for writing things like parsers and instead skip to the concrete stuff. Scroll down and you'll see that Activity Types include things like:</p>\n<ul>\n<li>Accept</li>\n<li>Block</li>\n<li>Follow</li>\n<li>Like</li>\n</ul>\n<p>Hey!! This is good! This is like... stuff that users do on social networks. Now we're getting somewhere.</p>\n<p>Browse over all the activities. Look at the \"Notes\" section and glance at the example JSON object. There are some interesting activity types in there! For example, there's <strong>Question</strong>, which is the activity type that Mastodon uses in its implementation of polls. And there's <strong>Travel</strong>, which is meant to indicate movement from geographic (or even conceptual) point A to point B! You might make extensive use of this if your social network supported a Facebook style \"I've checked in to New York City right now\" post. There's even a <strong>View</strong> activity, which can be used for read receipts.</p>\n<p>Anyway, read 'em.</p>\n<h3 id=\"actor-types\">Actor Types</h3>\n<p>An <strong>Actor</strong> is what you might think of as a user agent. It can be a person, a bot, a company, a group of people, and more. But the important thing is: an <strong>Actor</strong> is the <em>thing that is doing</em> an <strong>Activity</strong>.</p>\n<p>So a normal post to Mastodon is a <strong>Person</strong> actor doing a <strong>Create</strong> activity (what is being created is defined in the next section, Object types). Or if a company sent out discount codes to its followers, that would be an <strong>Organization</strong> doing an <strong>Offer</strong> activity.</p>\n<p>There aren't many <strong>Actor</strong> types listed so just read them all.</p>\n<h3 id=\"object-types\">Object Types</h3>\n<p>Yeah. I know. \"Object\" is probably the most overloaded English word in programming and we're already on our second thing called an object in this one spec. I'm sorry. Deep breaths, we'll get through this.</p>\n<p>Anyhow. These are the meat and potatoes of what actually gets sent around these networks. Object types include:</p>\n<ul>\n<li>Note</li>\n<li>Article</li>\n<li>Image</li>\n<li>Video</li>\n</ul>\n<p>...and several more. So when you make a regular text post to Mastodon, that is a case where a <strong>Person</strong> will <strong>Create</strong> a <strong>Note</strong>.</p>\n<h3 id=\"putting-it-all-together\">Putting it all together</h3>\n<p>Here's some code from <a href=\"https://github.com/dariusk/express-activitypub/\">a small ActivityPub reference implementation I wrote</a></p>\n<pre><code>  let noteMessage = {\n    'id': `https://${domain}/m/${guidNote}`,\n    'type': 'Note',\n    'published': d.toISOString(),\n    'attributedTo': `https://${domain}/u/${name}`,\n    'content': text,\n    'to': ['https://www.w3.org/ns/activitystreams#Public'],\n  };\n\n  let createMessage = {\n    '@context': 'https://www.w3.org/ns/activitystreams',\n\n    'id': `https://${domain}/m/${guidCreate}`,\n    'type': 'Create',\n    'actor': `https://${domain}/u/${name}`,\n    'to': ['https://www.w3.org/ns/activitystreams#Public'],\n    'cc': [follower],\n\n    'object': noteMessage\n  };\n</code></pre><p>I construct the <strong>Note</strong> object and the <strong>Create</strong> activity. The <strong>Note</strong> object gets embedded inside the <strong>Create</strong> activity, which indicates that we are <strong>Creat</strong>-ing a <strong>Note</strong>. What about the <strong>Person</strong>? That's implied in the 'actor' field of the <strong>Create</strong>, and that URL is the equivalent of passing the <strong>Person</strong> by reference. Any program parsing this out could query that URL and get the JSON of the <strong>Person</strong> from there.</p>\n<h2 id=\"properties\">Properties</h2>\n<p>If you're wondering what those \"id\", \"cc\", and so on fields mean, you're in luck. Those are described in this section, which contains the <em>other</em> 50% of the stuff you care about.</p>\n<p>Read this section, if only to familiarize yourself with what's here. That way you'll know to come back here when you see something like \"prev\" in a JSON object and wonder how that's supposed to be constructed.</p>\n<h2 id=\"implementation-notes\">Implementation Notes</h2>\n<p>This is where the concrete examples of things like \"how to represent a friend request\" live. Definitely worth reading this section as well, though on a first run through you really only need to read:</p>\n<ul>\n<li>5.1: Audience targeting (not about advertising, this is about what the \"to\" and \"cc\" fields mean. It's the difference between a direct message and a public message, for example.)</li>\n<li>5.2.1: Modeling a \"friend request\"</li>\n<li>5.5: How <strong>Undo</strong> does and does not work</li>\n<li>5.8: A nice conceptual grouping of what circumstances you might use different Activities in</li>\n</ul>\n\n<p>Next, read <a href=\"https://www.w3.org/TR/activitypub/\">the ActivityPub spec</a>. It's in seven major sections:</p>\n<ol>\n<li>Overview</li>\n<li>Conformance</li>\n<li>Objects</li>\n<li>Actors</li>\n<li>Collections</li>\n<li>Client to Server Interactions</li>\n<li>Server to Server Interactions</li>\n</ol>\n<p>But first, a word about JSON-LD.</p>\n<h2 id=\"a-note-on-json-ld\">A note on JSON-LD</h2>\n<p>Starting with the ActivityPub spec, you're going to see <a href=\"https://json-ld.org/\">JSON-LD</a> mentioned a bunch. You don't have to care about this at all. For our purposes it's JSON with some specific property names in it, and where you follow links to complete the content of an object. Is this technically 100% correct? No. But if you were the kind of person who cared about the difference between JSON-LD and JSON, you'd probably be writing your own spec right now instead of reading this article.</p>\n<h3 id=\"following-links-in-json\">Following links in JSON</h3>\n<p>One important thing to note about the kind of JSON stuff you'll be seeing is that you'll often see a URI embedded in a JSON object. Take the following example of an object with no URI anywhere in it:</p>\n<pre><code>{\n  \"id\": 1234,\n  \"object\": {\n    \"type\": \"Note\",\n    \"content\": \"Hello world.\"\n  }\n}\n</code></pre><p>Other times you'll see something like:</p>\n<pre><code>{\n  \"id\": 1234,\n  \"object\": \"https://example.com/5678\"\n}\n</code></pre><p>But then if you do a GET request with the appropriate headers to \"<a href=\"https://example.com/5678\">https://example.com/5678</a>\", you'll get</p>\n<pre><code>{\n  \"type\": \"Note\",\n  \"content\": \"Hello world.\"\n}\n</code></pre><p>These two JSON things comprise the exact same information as that first JSON thing. It's just split across two HTTP requests. When you encounter a URI in one of these JSON objects, the idea is to follow the URI in order to resolve it into plain JSON and consider that the sub-object.</p>\n<h2 id=\"overview\">Overview</h2>\n<p>Read this whole thing. You probably tried to read this once, before reading the Vocabulary spec, and if you're anything like me you were extremely confused. I promise it will be less confusing this time.</p>\n<p>Basically it explains that you're taking these JSON things described in the Vocabulary spec and POSTing them to specific API endpoints, which process them.</p>\n<h2 id=\"conformance\">Conformance</h2>\n<p>A short section that you might as well read. This is where it's made clear that this document actually describes <em>two separate protocols</em>. There is a Client to Server (C2S) and Server to Server (S2S).</p>\n<p>In order to make your service \"federated\" via ActivityPub, <em>the only protocol you really care about is the server to server protocol</em>. S2S is how a Mastodon server can talk to a Pleroma server can talk to a Pixelfed server etc etc. Federation as we know it.</p>\n<p>The C2S protocol is about <em>user choice</em>. It's a good thing, but it has nothing to do with federation. It's a standard way for user client software, like a phone app, to talk to a server. If we lived in a world where Mastodon and Pleroma and Pixelfed all used the C2S protocol, then in theory I could easily write a phone app that connects to all three of those services, and users could mix and match clients with servers to their heart's delight. A new service could pop up that I didn't even know about, but if it used C2S my phone app would be minimally compatible with it. (We do not live in this world, most federated services do not implement C2S, but this is the vision, to my understanding.)</p>\n<h2 id=\"objects\">Objects</h2>\n<p>This will be a much easier read now that you've read over the Vocabulary document.</p>\n<p>Specifically, sections 3, 3.1, and 3.2 are really important and discuss why, for example, if you send a message to a remote server, it should have some way of querying your server to confirm the message. I originally thought that I could get away with just sending messages into the void and not storing them in a local database, but I was wrong, because remote servers need to confirm that it's not just some random person claiming to send content from my own origin.</p>\n<h2 id=\"actors\">Actors</h2>\n<p>So an ActivityPub actor is an Activity Vocabulary actor, with the mandatory addition of an inbox and and outbox, which are typically URIs that you either GET or POST to depending on what you want to do with them. For example, you can GET from a user's outbox URI and receive a JSON list of posts. Try it on my outbox from Friend Camp right now in your web browser by <a href=\"https://friend.camp/users/darius/outbox\">browsing to this URL</a>. You should see something like this:</p>\n<pre><code>{\n  \"@context\":\"https://www.w3.org/ns/activitystreams\",\n  \"id\":\"https://friend.camp/users/darius/outbox\",\n  \"type\":\"OrderedCollection\",\n  \"totalItems\":5688,\n  \"first\":\"https://friend.camp/users/darius/outbox?page=true\",\n  \"last\":\"https://friend.camp/users/darius/outbox?min_id=0&amp;page=true\"\n}\n</code></pre><p>If you click through to <a href=\"https://friend.camp/users/darius/outbox?min_id=0&amp;page=true\">the \"last\" URI</a>, you'll get 20 of my oldest posts from Friend Camp, including <a href=\"https://friend.camp/@darius/100538943364185987\">this charmer</a>.</p>\n<p>Anyway, read this whole section too. It's short.</p>\n<h2 id=\"collections\">Collections</h2>\n<p>Skip this for now. You'll absolutely want to come back to this later but you can probably figure out what collections are in context of their usage (hint: that outbox JSON is a type of collection; it contains paging data for iterating through collections of stuff).</p>\n<p>But seriously just skip this for now, you don't need to muddy your brain with it.</p>\n<h2 id=\"client-to-server-interactions\">Client to Server Interactions</h2>\n<p>Look. If you want to support a universal client ecosystem, go ahead and read this section. But if you just want to write a federated service, skip it and come back to it later.</p>\n<h2 id=\"server-to-server-interactions\">Server to Server Interactions</h2>\n<p>Read this whole thing. This one section, combined with the Activity Vocabulary spec, forms the absolute basics of getting a federated service up and running. The Vocabulary spec tells you <em>what</em> to send, and this section tells you <em>how</em> to send it.</p>\n<p>Among other things, it discusses the difference between an <code>inbox</code> and a <code>sharedInbox</code>. It talks about how to <strong>Follow</strong> an <strong>Actor</strong>, and how someone might <strong>Accept</strong> or <strong>Reject</strong> a follow request. It talks about <strong>Announce</strong>, which in addition to literally being for announcements, is also your standard \"sharing\" activity, like an RT on Twitter or a boost on Mastodon.</p>\n<h2 id=\"reading-activitystreams-2-0\">Reading ActivityStreams 2.0</h2>\n<p>Eh. Don't read it now. Skim the table of contents. There will be bits of ActivityPub that don't make sense without the ActivityStreams 2.0 spec, but those will be more advanced questions you'll have later.</p>\n<h2 id=\"the-ultimate-tl-dr\">THE ULTIMATE TL;DR</h2>\n<ul>\n<li>Read the <a href=\"https://www.w3.org/TR/activitystreams-vocabulary/\">Activity Vocabulary spec</a>, sections 3, 4, 5.1, 5.2.1, 5.5, and 5.8</li>\n<li>Read the <a href=\"https://www.w3.org/TR/activitypub/\">ActivityPub spec</a>, sections 1, 2, 3, 4, and 7</li>\n<li>Familiarize yourself with the table of contents for the <a href=\"https://www.w3.org/TR/activitystreams-core/\">ActivityStreams 2.0 spec</a>.</li>\n</ul>\n<h2 id=\"go-forth-and-make-stuff\">Go forth and make stuff</h2>\n<p>Assuming you've done all this reading, the knowledge you have right now should hopefully be enough to start hacking on sending simple messages via ActivityPub.</p>\n<p>I recommend reading these two articles by Eugen Rochko, the creator of Mastodon:</p>\n<ul>\n<li><a href=\"https://blog.joinmastodon.org/2018/06/how-to-implement-a-basic-activitypub-server/\">How to implement a basic ActivityPub server</a></li>\n<li><a href=\"https://blog.joinmastodon.org/2018/07/how-to-make-friends-and-verify-requests/\">How to make friends and verify requests</a></li>\n</ul>\n<p>If you're like me and you enjoy poking around at a simple implementation, I have written a bare bones JavaScript ActivityPub server using the popular Express application framework:</p>\n<ul>\n<li><a href=\"https://github.com/dariusk/express-activitypub\">Express ActivityPub Server</a></li>\n</ul>\n\n\n</div>","textContent":"‚Üê Tiny Subversions\nA highly opinionated guide to learning about ActivityPub\nby Darius Kazemi, Jun 1, 2019\nThis document is for programmers who take one look at activitypub.rocks, click on through to the documentation, and can't make heads or tails of it.\nIn other words this document is for me, one year ago.\nIMPORTANT NOTE: This document does not explain ActivityPub. It explains how to learn about ActivityPub.\nIf you want THE ULTIMATE TL;DR, just skip to that section.\nTable of contents\n\nIntroduction\nStart with Activity Vocabulary\n\n\nReading Activity Vocabulary\nIntroduction\nCore Types\nExtended Types\nActivity Types\nActor Types\nObject Types\nPutting it all together\n\n\nProperties\nImplemenation Notes\n\n\nReading ActivityPub\nA note on JSON-LD\nFollowing links in JSON\n\n\nOverview\nConformance\nObjects\nActors\nCollections\nClient to Server Interactions\nServer to Server Interactions\n\n\nReading ActivityStreams 2.0\nTHE ULTIMATE TL;DR\nGo forth and make stuff\n\nIntroduction\nThe one big misunderstanding that a programmer can have when attempting to learn about ActivityPub is to assume that all the information you need is in the ActivityPub spec! Really, to learn about ActivityPub in such a way that it will be useful in a concrete sense, you need to be familiar with three specs:\n\nActivityPub\nActivityStreams 2.0\nActivity Vocabulary\n\nThose two extra documents are in fact mentioned in the ActivityPub spec itself, so I'm not claiming that they are somehow hidden. But I'm a lazy, impatient reader. When I'm given a spec like ActivityPub that is ~10,000 words of spec language... well. I'm going to try and take all the shortcuts I can.\nI thought I was the only programmer with this problem, but as I spoke to more and more people at conferences, I realized there are many others who, for example, look at ActivityPub and yet have no idea there exists an Activity Vocabulary spec.\nStart with Activity Vocabulary\nI am a concrete thinker. I don't like reading about a system for passing messages between computers if I can't have some sort of understanding of what exactly is being passed around.\nUnfortunately, the ActivityPub spec is mostly all about the \"publication\" part and not the \"what data are we sending around\" part.\nFor this reason, I recommend that you start your journey into ActivityPub by first reading the Activity Vocabulary spec.\nReading Activity Vocabulary\nThis spec is in five non-appendix sections:\n\nIntroduction\nCore Types\nExtended Types\nProperties\nImplementation Notes\n\nIntroduction\nThe intro is brief, and is your usual spec boilerplate about  the definitions of MUST and SHOULD.\nCore Types\n\"Core Types\" is where you might think you should start. It's the core, right? Well, you're wrong. The first thing you're hit with is a definition of Object:\n\nDescribes an object of any kind. The Object type serves as the base type for most of the other kinds of objects defined in the Activity Vocabulary, including other Core types such as Activity, IntransitiveActivity, Collection and OrderedCollection. \n\nThe example given is:\n{\n  \"@context\": \"https://www.w3.org/ns/activitystreams\",\n  \"type\": \"Object\",\n  \"id\": \"http://www.test.example/object/1\",\n  \"name\": \"A Simple, non-specific object\"\n}\nWow. That's real useful. Now I know how to define a non-specific thing with no properties.\n(Aside: this \"begin from first principles\" thing is a problem with almost all spec writing. It is largely how specs are written and it fucking blows. The authors of these documents are just following tradition and I do not wish to paint these specs as particularly bad.)\nJust skip the Core Types for now and move onto section 3, Extended Types.\nExtended Types\nAh, Extended Types. Or as I like to call them: the actually-useful types. Something like 50% of the stuff you actually care about is in this section.\nWe are given three major kinds of \"types\". (Um, by the way, this isn't quite a \"type\" as you may know it. It's really more like a JSON data format.)\n\nActivity Types\nActor Types\nObject Types\n\nActivity Types\nWe are once again immediately hit over the head with this doozy of a sentence:\n\nAll Activity Types inherit the properties of the base Activity type.\n\nWhile this does make sense in a highly specific way that is unique to specification writing, please just skip this sentence and all sentences like it (there is at least one other saying the same thing about Object Types).\nBest to avoid the near-tautological definitions required for writing things like parsers and instead skip to the concrete stuff. Scroll down and you'll see that Activity Types include things like:\n\nAccept\nBlock\nFollow\nLike\n\nHey!! This is good! This is like... stuff that users do on social networks. Now we're getting somewhere.\nBrowse over all the activities. Look at the \"Notes\" section and glance at the example JSON object. There are some interesting activity types in there! For example, there's Question, which is the activity type that Mastodon uses in its implementation of polls. And there's Travel, which is meant to indicate movement from geographic (or even conceptual) point A to point B! You might make extensive use of this if your social network supported a Facebook style \"I've checked in to New York City right now\" post. There's even a View activity, which can be used for read receipts.\nAnyway, read 'em.\nActor Types\nAn Actor is what you might think of as a user agent. It can be a person, a bot, a company, a group of people, and more. But the important thing is: an Actor is the thing that is doing an Activity.\nSo a normal post to Mastodon is a Person actor doing a Create activity (what is being created is defined in the next section, Object types). Or if a company sent out discount codes to its followers, that would be an Organization doing an Offer activity.\nThere aren't many Actor types listed so just read them all.\nObject Types\nYeah. I know. \"Object\" is probably the most overloaded English word in programming and we're already on our second thing called an object in this one spec. I'm sorry. Deep breaths, we'll get through this.\nAnyhow. These are the meat and potatoes of what actually gets sent around these networks. Object types include:\n\nNote\nArticle\nImage\nVideo\n\n...and several more. So when you make a regular text post to Mastodon, that is a case where a Person will Create a Note.\nPutting it all together\nHere's some code from a small ActivityPub reference implementation I wrote\n  let noteMessage = {\n    'id': `https://${domain}/m/${guidNote}`,\n    'type': 'Note',\n    'published': d.toISOString(),\n    'attributedTo': `https://${domain}/u/${name}`,\n    'content': text,\n    'to': ['https://www.w3.org/ns/activitystreams#Public'],\n  };\n\n  let createMessage = {\n    '@context': 'https://www.w3.org/ns/activitystreams',\n\n    'id': `https://${domain}/m/${guidCreate}`,\n    'type': 'Create',\n    'actor': `https://${domain}/u/${name}`,\n    'to': ['https://www.w3.org/ns/activitystreams#Public'],\n    'cc': [follower],\n\n    'object': noteMessage\n  };\nI construct the Note object and the Create activity. The Note object gets embedded inside the Create activity, which indicates that we are Creat-ing a Note. What about the Person? That's implied in the 'actor' field of the Create, and that URL is the equivalent of passing the Person by reference. Any program parsing this out could query that URL and get the JSON of the Person from there.\nProperties\nIf you're wondering what those \"id\", \"cc\", and so on fields mean, you're in luck. Those are described in this section, which contains the other 50% of the stuff you care about.\nRead this section, if only to familiarize yourself with what's here. That way you'll know to come back here when you see something like \"prev\" in a JSON object and wonder how that's supposed to be constructed.\nImplementation Notes\nThis is where the concrete examples of things like \"how to represent a friend request\" live. Definitely worth reading this section as well, though on a first run through you really only need to read:\n\n5.1: Audience targeting (not about advertising, this is about what the \"to\" and \"cc\" fields mean. It's the difference between a direct message and a public message, for example.)\n5.2.1: Modeling a \"friend request\"\n5.5: How Undo does and does not work\n5.8: A nice conceptual grouping of what circumstances you might use different Activities in\n\n\nNext, read the ActivityPub spec. It's in seven major sections:\n\nOverview\nConformance\nObjects\nActors\nCollections\nClient to Server Interactions\nServer to Server Interactions\n\nBut first, a word about JSON-LD.\nA note on JSON-LD\nStarting with the ActivityPub spec, you're going to see JSON-LD mentioned a bunch. You don't have to care about this at all. For our purposes it's JSON with some specific property names in it, and where you follow links to complete the content of an object. Is this technically 100% correct? No. But if you were the kind of person who cared about the difference between JSON-LD and JSON, you'd probably be writing your own spec right now instead of reading this article.\nFollowing links in JSON\nOne important thing to note about the kind of JSON stuff you'll be seeing is that you'll often see a URI embedded in a JSON object. Take the following example of an object with no URI anywhere in it:\n{\n  \"id\": 1234,\n  \"object\": {\n    \"type\": \"Note\",\n    \"content\": \"Hello world.\"\n  }\n}\nOther times you'll see something like:\n{\n  \"id\": 1234,\n  \"object\": \"https://example.com/5678\"\n}\nBut then if you do a GET request with the appropriate headers to \"https://example.com/5678\", you'll get\n{\n  \"type\": \"Note\",\n  \"content\": \"Hello world.\"\n}\nThese two JSON things comprise the exact same information as that first JSON thing. It's just split across two HTTP requests. When you encounter a URI in one of these JSON objects, the idea is to follow the URI in order to resolve it into plain JSON and consider that the sub-object.\nOverview\nRead this whole thing. You probably tried to read this once, before reading the Vocabulary spec, and if you're anything like me you were extremely confused. I promise it will be less confusing this time.\nBasically it explains that you're taking these JSON things described in the Vocabulary spec and POSTing them to specific API endpoints, which process them.\nConformance\nA short section that you might as well read. This is where it's made clear that this document actually describes two separate protocols. There is a Client to Server (C2S) and Server to Server (S2S).\nIn order to make your service \"federated\" via ActivityPub, the only protocol you really care about is the server to server protocol. S2S is how a Mastodon server can talk to a Pleroma server can talk to a Pixelfed server etc etc. Federation as we know it.\nThe C2S protocol is about user choice. It's a good thing, but it has nothing to do with federation. It's a standard way for user client software, like a phone app, to talk to a server. If we lived in a world where Mastodon and Pleroma and Pixelfed all used the C2S protocol, then in theory I could easily write a phone app that connects to all three of those services, and users could mix and match clients with servers to their heart's delight. A new service could pop up that I didn't even know about, but if it used C2S my phone app would be minimally compatible with it. (We do not live in this world, most federated services do not implement C2S, but this is the vision, to my understanding.)\nObjects\nThis will be a much easier read now that you've read over the Vocabulary document.\nSpecifically, sections 3, 3.1, and 3.2 are really important and discuss why, for example, if you send a message to a remote server, it should have some way of querying your server to confirm the message. I originally thought that I could get away with just sending messages into the void and not storing them in a local database, but I was wrong, because remote servers need to confirm that it's not just some random person claiming to send content from my own origin.\nActors\nSo an ActivityPub actor is an Activity Vocabulary actor, with the mandatory addition of an inbox and and outbox, which are typically URIs that you either GET or POST to depending on what you want to do with them. For example, you can GET from a user's outbox URI and receive a JSON list of posts. Try it on my outbox from Friend Camp right now in your web browser by browsing to this URL. You should see something like this:\n{\n  \"@context\":\"https://www.w3.org/ns/activitystreams\",\n  \"id\":\"https://friend.camp/users/darius/outbox\",\n  \"type\":\"OrderedCollection\",\n  \"totalItems\":5688,\n  \"first\":\"https://friend.camp/users/darius/outbox?page=true\",\n  \"last\":\"https://friend.camp/users/darius/outbox?min_id=0&page=true\"\n}\nIf you click through to the \"last\" URI, you'll get 20 of my oldest posts from Friend Camp, including this charmer.\nAnyway, read this whole section too. It's short.\nCollections\nSkip this for now. You'll absolutely want to come back to this later but you can probably figure out what collections are in context of their usage (hint: that outbox JSON is a type of collection; it contains paging data for iterating through collections of stuff).\nBut seriously just skip this for now, you don't need to muddy your brain with it.\nClient to Server Interactions\nLook. If you want to support a universal client ecosystem, go ahead and read this section. But if you just want to write a federated service, skip it and come back to it later.\nServer to Server Interactions\nRead this whole thing. This one section, combined with the Activity Vocabulary spec, forms the absolute basics of getting a federated service up and running. The Vocabulary spec tells you what to send, and this section tells you how to send it.\nAmong other things, it discusses the difference between an inbox and a sharedInbox. It talks about how to Follow an Actor, and how someone might Accept or Reject a follow request. It talks about Announce, which in addition to literally being for announcements, is also your standard \"sharing\" activity, like an RT on Twitter or a boost on Mastodon.\nReading ActivityStreams 2.0\nEh. Don't read it now. Skim the table of contents. There will be bits of ActivityPub that don't make sense without the ActivityStreams 2.0 spec, but those will be more advanced questions you'll have later.\nTHE ULTIMATE TL;DR\n\nRead the Activity Vocabulary spec, sections 3, 4, 5.1, 5.2.1, 5.5, and 5.8\nRead the ActivityPub spec, sections 1, 2, 3, 4, and 7\nFamiliarize yourself with the table of contents for the ActivityStreams 2.0 spec.\n\nGo forth and make stuff\nAssuming you've done all this reading, the knowledge you have right now should hopefully be enough to start hacking on sending simple messages via ActivityPub.\nI recommend reading these two articles by Eugen Rochko, the creator of Mastodon:\n\nHow to implement a basic ActivityPub server\nHow to make friends and verify requests\n\nIf you're like me and you enjoy poking around at a simple implementation, I have written a bare bones JavaScript ActivityPub server using the popular Express application framework:\n\nExpress ActivityPub Server\n\n\n\n","length":15069,"excerpt":"‚Üê Tiny Subversions","byline":null,"dir":null,"siteName":null,"lang":"en"},"finalizedMeta":{"title":"reading-activitypub","description":"‚Üê Tiny Subversions","author":false,"creator":"","publisher":false,"date":"2022-03-09T18:43:55.345Z","topics":[]},"jsonLd":{"@type":false,"headline":false,"description":false,"image":[],"mainEntityOfPage":{"@type":false,"@id":false},"datePublished":false,"dateModified":false,"isAccessibleForFree":false,"isPartOf":{"@type":[],"name":false,"productID":false},"discussionUrl":false,"license":false,"author":{"@type":false,"name":false,"description":false,"sameAs":false,"image":{"@type":false,"url":false},"givenName":false,"familyName":false,"alternateName":false,"publishingPrinciples":false},"publisher":{"@type":false,"name":false,"description":false,"sameAs":false,"logo":{"@type":false,"url":false},"publishingPrinciples":false},"editor":{"@type":false,"name":false,"description":false,"sameAs":false,"image":{"@type":false,"url":false},"givenName":false,"familyName":false,"alternateName":false,"publishingPrinciples":false}},"twitterObj":false,"status":200,"metadata":{"author":false,"title":"reading-activitypub","description":false,"canonical":"https://tinysubversions.com/notes/reading-activitypub/","keywords":[],"image":false,"firstParagraph":"‚Üê Tiny Subversions"},"dublinCore":{},"opengraph":{"title":false,"description":false,"url":false,"site_name":false,"locale":false,"type":false,"typeObject":{"published_time":false,"modified_time":false,"author":false,"publisher":false,"section":false,"tag":[]},"image":false},"twitter":{"site":false,"description":false,"card":false,"creator":false,"title":false,"image":false},"archivedData":{"link":false,"wayback":false}}}